const outW = 1080;   // izhodna širina
const outH = 1920;   // izhodna višina (portrait 9:16)
canvas.width = outW;
canvas.height = outH;

const ctx = canvas.getContext('2d');

// dimenzije surovega videa
const vw = video.videoWidth;
const vh = video.videoHeight;

// izračun "cover": povečaj tako, da prekrije cel canvas, potem obreži višek
const scale = Math.max(outW / vw, outH / vh);
const drawW = vw * scale;
const drawH = vh * scale;
const dx = (outW - drawW) / 2;
const dy = (outH - drawH) / 2;

// če je sprednja kamera, zrcali, da se ujema s prikazom
if (facingMode === "user") {
  ctx.save();
  ctx.translate(outW, 0);
  ctx.scale(-1, 1);
  ctx.drawImage(video, -dx - drawW, dy, drawW, drawH);
  ctx.restore();
} else {
  ctx.drawImage(video, dx, dy, drawW, drawH);
}

// masko nariši čez v ISTI izhodni velikosti (tvoja PNG naj bo 1080x1920 ali vsaj enakega razmerja)
ctx.drawImage(mask, 0, 0, outW, outH);
